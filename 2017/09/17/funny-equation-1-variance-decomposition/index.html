<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>好玩的公式系列1：方差分解的联想 | 西瓜的木屋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在“A FIRST COURSE IN PROBABILITY”里，偶然看到如下的条件方差分解公式：$$Var(X) = Var(E[X|Z])+ E_X[Var(X|Z)]$$于是我换了变量名，一下子熟悉起来：$$Var(Y) = Var(E_Y[Y|X])+ E_X[Var(Y|X)] $$

在机器学习中，X看做特征，Y为目标；在统计里，X看做自变量，Y看做因变量
它表达了理想情况下，采用M">
<meta property="og:type" content="article">
<meta property="og:title" content="好玩的公式系列1：方差分解的联想">
<meta property="og:url" content="http://luoxc.com/2017/09/17/funny-equation-1-variance-decomposition/index.html">
<meta property="og:site_name" content="西瓜的木屋">
<meta property="og:description" content="在“A FIRST COURSE IN PROBABILITY”里，偶然看到如下的条件方差分解公式：$$Var(X) = Var(E[X|Z])+ E_X[Var(X|Z)]$$于是我换了变量名，一下子熟悉起来：$$Var(Y) = Var(E_Y[Y|X])+ E_X[Var(Y|X)] $$

在机器学习中，X看做特征，Y为目标；在统计里，X看做自变量，Y看做因变量
它表达了理想情况下，采用M">
<meta property="og:updated_time" content="2017-12-30T16:43:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="好玩的公式系列1：方差分解的联想">
<meta name="twitter:description" content="在“A FIRST COURSE IN PROBABILITY”里，偶然看到如下的条件方差分解公式：$$Var(X) = Var(E[X|Z])+ E_X[Var(X|Z)]$$于是我换了变量名，一下子熟悉起来：$$Var(Y) = Var(E_Y[Y|X])+ E_X[Var(Y|X)] $$

在机器学习中，X看做特征，Y为目标；在统计里，X看做自变量，Y看做因变量
它表达了理想情况下，采用M">
  
    <link rel="alternate" href="/atom.xml" title="西瓜的木屋" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="../../../../css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../../../index.html" id="logo">西瓜的木屋</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="../../../../index.html" id="subtitle">记录关于机器学习、智能逻辑、人文社科方面的读书心得</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="../../../../index.html">Home</a>
        
          <a class="main-nav-link" href="../../../../archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://luoxc.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-funny-equation-1-variance-decomposition" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2017-09-17T05:51:46.000Z" itemprop="datePublished">2017-09-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../../../../categories/机器的理智/">机器的理智</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      好玩的公式系列1：方差分解的联想
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在“A FIRST COURSE IN PROBABILITY”里，偶然看到如下的条件方差分解公式：<br>$$Var(X) = Var(E[X|Z])+ E_X[Var(X|Z)]$$<br>于是我换了变量名，一下子熟悉起来：<br><strong>$$Var(Y) = Var(E_Y[Y|X])+ E_X[Var(Y|X)] $$</strong></p>
<ul>
<li>在机器学习中，X看做特征，Y为目标；在统计里，X看做自变量，Y看做因变量</li>
<li>它表达了理想情况下，采用<strong>MSE准则</strong>，预测函数$Y=g(X)=E_Y[Y|X]$时的方差组成：<ul>
<li>可以解读为: $target_var =  captured_var + MSE$<ul>
<li>$ Var(E_Y[Y|X])$: $captured_var$, 表征预测模型捕获的方差。</li>
<li>$ E_X[Var(Y|X)] $：表征预测残差，此时的MSE只有噪声，没有模型偏差。</li>
<li>$R^2 = \frac{Var(E_Y[Y|X])}{Var(Y)} $: 统计学里称之为<strong>“决定系数”</strong>。$R^2$越接近1，则表明$Y$的方差几乎都被$g(X)$捕获，预测残差小，预测的效果好；也说明数据质量好，噪音小！在这种理想情况下($g(X) = E_Y[Y|X]$)，可以用$R^2$评估数据质量。</li>
</ul>
</li>
</ul>
</li>
<li><p>事实上，往往预测函数$Y=g(X)\  \neq E_Y[Y|X]$：</p>
<ul>
<li>预测函数不能有效捕获Y的方差，MSE增大：$captured_var &lt; Var(E_Y[Y|X])$，$MSE &gt; E_X[Var(Y|X)]$,<ul>
<li>MSE的误差来源包含两部分：固有噪声$E_X[Var(Y|X)]$（机器学习中称为<strong>方差variance</strong>）和模型误差（机器学习中称为<strong>偏差bias</strong>），具体见下文证明。</li>
<li>若$g(X)$太差，将导致模型偏差部分非常大！机器学习中称之为“<strong>欠拟合</strong>”，下面是可能的原因：<ul>
<li>数据量过小，不能有效的估计出$E[Y|X]$</li>
<li>特征太差，没有表征力（极端情况下X和Y独立，见下文分析）</li>
<li>假设空间容量不够大，没有$E_X[Y|X]$及其有效近似。（如采用线性拟合非线性数据）<ul>
<li>假设空间足够大，但是没有有效的搜索策略。（如nerual network高度非凸的搜索空间）</li>
</ul>
</li>
</ul>
</li>
<li>要防止在训练集上过度拟合$g(X)$：<ul>
<li>机器学习中称之为<strong>“过拟合”</strong>：在训练集上近乎完美的拟合数据，但在测试集上表现糟糕, 因为：</li>
<li>现实数据集往往是有限的、有噪声的<ul>
<li>数据有限：极有限的数据可能难以反应真实数据分布， $g(X)$可能会拟合出过于复杂但不真实的形状，它可能会造成方差和偏差都增大；</li>
<li>数据噪声：噪声往往来源于固有噪声、数据收集噪声(如生产系统上的各种错误导致label不正确)等。这里只考虑固有噪声，即Y并不是X的确定性函数（如MSE假设$y = f(x) + \delta, \ \delta \sim N(0, \sigma)$）。通常，完美拟合训练集，$g(X)$会拟合噪声的波动，导致函数过于复杂，极小的$\Delta x$，会带来极大的$\Delta g(x)$；即我们通常所说的“方差过大，导致过拟合”</li>
<li>一般而言，我们在减小偏差(解决欠拟合)时，要防范方差爆炸（防范过拟合），可以采取正则化,drop out，bagging等一系列措施。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>当$X$与$Y$独立时（即特征X太烂，无法表征目标Y）: </p>
<ul>
<li>公式右边退化为$Var(Y) + 0$<ul>
<li>预测函数将完全无法捕获$Y$的方差</li>
<li>MSE中的偏差部分将增大！（特征工程很重要）</li>
</ul>
</li>
</ul>
</li>
<li><p>如何更好的使$g(X)$逼近$E[Y|X]$呢？</p>
<ul>
<li>对于条件期望$E[Y|X]$, 若对于每一个可能的$X$, 都有足够多样本来估计Y的条件期望；之后的预测，就只需查表。显然，不符合现实。<ul>
<li>对每个点$X$我们无法得到足够样本，但是可以将X的空间分段，进行分段拟合；</li>
<li>分段拟合为防止过拟合，可以限定假设空间为3次自然样条。</li>
<li>KNN采用$g(x) = Avg(y_i\ |\ x_i \in N_k(x))$来近似$E[Y|X=x]$</li>
</ul>
</li>
</ul>
</li>
<li><p>在抽样理论中：可尝试使用随机变量$E_Y[Y|X]$ 代替$Y$来模拟$E[Y]$,减小抽样方差， 因为：</p>
<ul>
<li>$E_X[E_Y[Y|X]] = E[Y]$<ul>
<li>$Var(E_Y[Y|X]) \le Var(Y)$</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>MSE预测：</strong>对于MSE损失函数$L = E[Y-g(X)]^2$的解为：$g(X) = E[Y|X]$<br><strong>引理：</strong> $$\forall g(X), E[(Y-g(X))^2 | X] = \<br> E[(Y- E[Y|X])^2 |X] + E[(E(Y|X) - g(X))^2|X] \<br> \ge  E[(Y- E[Y|X])^2 |X]$$</p>
<ul>
<li>$ E[(Y- E[Y|X])^2 |X] $：数据分布固有噪声,如高斯白噪声等。称之为方差variance。</li>
<li>$E[(E(Y|X) - g(X))^2|X] $:  模型误差部分，称之为偏差bias。如真实函数为二次，却用线性回归拟合。模型误差受限于假设空间的容量，也受限于在假设空间的搜索过程（可能是局部最小值，并不能得到最优的$E(Y|X)$）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://luoxc.com/2017/09/17/funny-equation-1-variance-decomposition/" data-id="cjbtorxy70002575dbshfdtd3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../../12/30/influence/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          《影响力》摘要
        
      </div>
    </a>
  
  
    <a href="../godel-proof/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">哥德尔不完全性</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/人文的意义/">人文的意义</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/机器的理智/">机器的理智</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/琐碎的胜利/">琐碎的胜利</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/逻辑的引擎/">逻辑的引擎</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2017/02/">February 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../../12/31/tf-tutorial/">Tensorflow简明导论</a>
          </li>
        
          <li>
            <a href="../../../12/30/information-history/">《信息简史》--信息的本质</a>
          </li>
        
          <li>
            <a href="../../../12/30/influence/">《影响力》摘要</a>
          </li>
        
          <li>
            <a href="">好玩的公式系列1：方差分解的联想</a>
          </li>
        
          <li>
            <a href="../godel-proof/">哥德尔不完全性</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Finch Luo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.2/latest.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>